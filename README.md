# レストランシフト管理システム v3.0

## 📋 プロジェクト概要

レストランのシフト管理を効率化する、和風デザインの白基調Webアプリケーションです。
アルバイトスタッフと正社員が、それぞれの役割に応じてシフトの提出・管理・承認を行えます。

---

## 🎨 デザインコンセプト

**白基調の和風デザイン**
- 和紙のような温かみのある白背景
- 墨色（深い黒・グレー）の落ち着いたテキスト
- 金色（#c9a961）のアクセントカラー
- 細い線と余白を活かした洗練された構成
- 侘び寂びを感じさせるミニマリズム
- さりげない装飾（◆、｜などの和風記号）

---

## ✨ 主な機能

### 🔐 認証システム
- **ログイン機能**: 名前 + 4桁暗証番号
- **アルバイト新規登録**: 個人申請 → 社員承認制
- **マスターキー**: 全アカウント共通（開発者のみ知る）
- **セッション管理**: ログイン状態保持
- **暗証番号変更**: アルバイト・社員ともに可能

### 👥 アルバイト機能
- ✅ 確定シフト閲覧（全員 / 自分のみ 切替可能）
- 📝 次シフトの提出・修正（カレンダー形式）
- 📊 提出状況の確認（提出済み / 未提出）
- 🔄 リアルタイム更新（ログイン状態保持でデータ再読み込み）
- 🔑 暗証番号変更
- 🎭 ローディング演出

### 🏢 社員（kokian）機能
- 📈 シフト提出状況の可視化
  - 提出人数 / 未提出人数
  - 提出者・未提出者リスト（更新日時付き）
- 📋 確定版・収集中シフト表管理
- 🗑️ 3種類の削除機能
  - セル単位（特定人の特定日）
  - スタッフ単位（特定人の全シフト）
  - 日付単位（特定日の全員シフト）
- 🚀 シフト公開機能（次期間の自動生成）
- ⏪ 確定撤回機能（シフトデータは保持）
- 💾 Excel / PDF ダウンロード
- 👤 アカウント管理
  - 承認待ちリスト（承認 / 拒否）
  - 承認済みリスト
  - 暗証番号リセット（1111に戻す）
  - アカウント削除（シフトデータも削除）
- 🔑 暗証番号変更

---

## 🗂️ ファイル構成

```
shift-management-v3/
├── index.html          (11.0 KB) - メインHTML
├── css/
│   └── style.css      (20.9 KB) - 和風白基調スタイルシート
├── js/
│   └── main.js        (41.9 KB) - アプリケーションロジック
└── README.md          (本ファイル)
```

---

## 🗄️ データベース構造

### 📊 テーブル一覧

#### 1. `accounts` - アカウント情報
| フィールド | 型 | 説明 |
|---------|-----|-----|
| id | text | アカウントID（UUID） |
| username | text | ユーザー名（漢字フルネーム） |
| password | text | 暗証番号（4桁） |
| account_type | text | アカウント種別（staff / manager） |
| status | text | ステータス（pending / approved） |
| created_at | datetime | 登録日時 |
| approved_at | datetime | 承認日時 |

#### 2. `shift_periods` - シフト期間
| フィールド | 型 | 説明 |
|---------|-----|-----|
| id | text | 期間ID（UUID） |
| start_date | text | 開始日（YYYY-MM-DD） |
| end_date | text | 終了日（YYYY-MM-DD） |
| status | text | ステータス（confirmed / collecting / archived） |
| display_name | text | 表示名 |

#### 3. `shifts` - シフトデータ
| フィールド | 型 | 説明 |
|---------|-----|-----|
| id | text | シフトID（UUID） |
| period_id | text | 期間ID |
| staff_name | text | スタッフ名 |
| date | text | 日付（YYYY-MM-DD） |
| shift_type | text | シフト種別（B, C, L, N, CL, BL, BN, CN） |

---

## 🚀 初期データ

### デフォルトアカウント
- **社員アカウント**: `kokian` / `1111`

### デフォルトシフト期間
- **確定版**: 2025/12/16 〜 2026/01/15
- **収集中**: 2026/01/16 〜 2026/02/15

---

## 📖 利用方法

### 🏁 初回セットアップ

1. **社員ログイン**
   - 名前: `kokian`
   - 暗証番号: `1111`

2. **アルバイトへURL共有**
   - アルバイトに登録用URLを送付

3. **アルバイトアカウント承認**
   - 社員が「アカウント管理」タブで承認

4. **運用開始**

### 👤 アルバイトの使い方

1. **新規登録**
   - ログイン画面で「新規登録はこちら」
   - 漢字フルネーム + 4桁暗証番号入力
   - 社員承認を待つ

2. **ログイン後**
   - 「確定シフト」タブ: 今月のシフト確認（全員 / 自分）
   - 「シフト提出」タブ: 来月希望シフト入力
   - 「設定」タブ: 暗証番号変更

3. **シフト提出**
   - カレンダーで日付ごとに選択
   - 「提出」ボタンで送信
   - 修正も同じ手順

### 🏢 社員の使い方

1. **ログイン**
   - 名前: `kokian`
   - 暗証番号: `1111`（変更推奨）

2. **ダッシュボード**
   - 提出状況をリアルタイム確認
   - 承認待ちアカウントを確認

3. **シフト管理**
   - 「確定版シフト」: 今月確定分
   - 「収集中シフト」: 来月希望分
     - セル / スタッフ / 日付単位で削除可能
     - 手動調整も可能

4. **シフト公開**
   - 「次のシフトを公開」ボタン
   - 収集中 → 確定版に移行
   - 新しい収集期間が自動生成

5. **確定撤回**
   - 誤って公開した場合
   - 「確定を撤回」ボタン
   - 1つ前の状態に戻る（データは保持）

6. **アカウント管理**
   - 承認待ちリスト: 承認 / 拒否
   - 承認済みリスト: 暗証番号リセット / 削除

7. **ダウンロード**
   - Excel形式: シフト表を.xlsxで保存
   - PDF形式: 印刷用にPDFで保存

---

## 🔧 技術スタック

### フロントエンド
- **HTML5**: セマンティックマークアップ
- **CSS3**: 和風白基調デザイン、レスポンシブ対応
- **Vanilla JavaScript**: フレームワーク不使用

### ライブラリ（CDN）
- **SheetJS (xlsx)**: Excelファイル生成
- **jsPDF**: PDFファイル生成
- **jsPDF-AutoTable**: PDF表生成
- **Google Fonts (Noto Serif JP)**: 和風フォント

### バックエンド / データベース
- **RESTful Table API**: データ永続化
  - `GET /tables/{table}` - レコード一覧取得
  - `GET /tables/{table}/{id}` - 単一レコード取得
  - `POST /tables/{table}` - 新規作成
  - `PUT /tables/{table}/{id}` - 完全更新
  - `PATCH /tables/{table}/{id}` - 部分更新
  - `DELETE /tables/{table}/{id}` - 削除

---

## 📅 変更履歴

### v3.0 (2025年12月17日) - 白基調の和風デザイン
- 🎨 **デザイン全面刷新**: 黒基調 → 白基調の和風デザイン
- 🖼️ **和風要素追加**: 和紙テクスチャ、金色アクセント、装飾記号
- 🎨 **配色変更**: 白（#f5f3ef）背景、墨色（#2a2a2a）テキスト、金色（#c9a961）アクセント
- 🌸 **土日色分け**: 土曜（水色系）、日曜（ピンク系）
- ✨ **シャドウ・グラデーション**: 柔らかく洗練された表現

### v3.0 初回リリース (2025年12月17日)
- 🔐 **認証システム実装**: ログイン必須化
- 👤 **アカウント管理**: 新規登録・承認・削除
- 📊 **提出状況可視化**: 提出者・未提出者の一目確認
- 🔄 **リフレッシュボタン**: ログイン状態保持で更新
- 🎭 **ローディング演出**: 処理中の視覚的フィードバック
- 📝 **ボタン表記変更**: 「保存」→「提出」
- ⏪ **撤回機能修正**: シフトデータを保持したまま撤回
- 👁️ **閲覧権限**: 確定シフトは全員/自分切替、収集中は自分のみ

### v2.4 (2025年12月17日)
- 🐛 **複数人シフト保存バグ修正**: 最後の人だけ残る問題を解決
- 🗑️ **セル単位削除機能**: 特定人の特定日のシフトを削除可能に
- 🔒 **セキュリティ向上**: マスターキー表記を完全削除

### v2.3 (2025年12月17日)
- 🕐 **JST統一**: 全日付処理を日本標準時に統一

### v2.2 (2025年12月17日)
- 🗑️ **削除機能追加**: スタッフ単位・日付単位の削除
- 🔄 **データリセット機能**: テストデータクリア

### v2.1 (2025年12月17日)
- ⏪ **確定撤回機能**: 誤公開の取り消し（1つ前まで）
- ✏️ **シフト修正機能**: 既存データを自動反映して編集可能

### v2.0 (2025年12月17日) - 初回メジャーアップデート
- 🐛 **年度計算バグ修正**: 2025-2026年度対応
- 🐛 **シフト希望反映バグ修正**: データ保存・取得ロジック改修
- 🐛 **ログアウト機能バグ修正**: セッション管理強化
- 🗓️ **日付表示削除**: UI簡素化
- 💾 **ダウンロード形式変更**: CSV → Excel / PDF
- 📝 **パスワード画面表記修正**: 「現在のパスワード」に統一

### v1.0 (2025年12月16日) - 初回リリース
- 📅 **シフト管理基本機能**: 16日〜15日サイクル
- 👤 **スタッフ機能**: 確定シフト閲覧、希望提出
- 🏢 **課長機能**: シフト管理、公開、ダウンロード
- 🔐 **パスワード保護**: 初期パスワード `1111`、マスターキー `ktwk`

---

## 🔐 セキュリティ

- ✅ ログイン必須（認証なしでアクセス不可）
- ✅ 4桁暗証番号（平文保存 ※本番環境ではハッシュ化推奨）
- ✅ マスターキー（開発者のみ知る共通キー）
- ✅ セッション管理（ログアウトで完全クリア）
- ✅ アカウント承認制（社員による承認必須）

---

## 🌐 公開URL

**Publishタブから公開後、URLが表示されます**

---

## 📝 推奨される次のステップ

1. **暗証番号のハッシュ化**: bcryptなどでセキュリティ強化
2. **メール通知**: 承認完了・シフト公開時の自動通知
3. **シフト自動調整**: AIによる最適化
4. **スマホアプリ化**: PWA対応
5. **多店舗対応**: 店舗ごとのシフト管理
6. **勤務時間計算**: 労働時間の自動集計

---

## 🙏 お問い合わせ

システムに関するご質問・ご要望は、開発者までお気軽にご連絡ください。

---

**© 2025 レストランシフト管理システム v3.0**
